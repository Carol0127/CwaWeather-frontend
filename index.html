<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>å€‰é¼ æ°£è±¡å±€</title>
    <link rel="icon" type="image/png" href="./icon-v2.png" />
    <link rel="apple-touch-icon" href="./icon-v2.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="./icon-v2.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        /* å…¨æ–°çš„è¼•é€è‰²å½©ï¼Œä»¥æ·ºè—/é’è‰²ç‚ºä¸» */
        --primary-light: #8ecae6; /* æ·ºè— */
        --primary-dark: #ffffff; /* ç™½è‰²ï¼Œç”¨æ–¼å¼·èª¿æ•¸å­— */
        --warning-color: #ffb703; /* é»ƒè‰²è­¦å‘Š */
        --danger-color: #e74c3c; /* ç´…è‰²å±éšª */

        /* æ¯›ç»ç’ƒè¨­å®š */
        --glass-bg: rgba(255, 255, 255, 0.15);
        --glass-border: rgba(255, 255, 255, 0.3);
        --glass-shadow: 0 4px 15px 0 rgba(0, 0, 0, 0.2);

        /* å­—é«”é¡è‰²è¨­å®š */
        --text-light: #ffffff; /* æ·ºè‰²æ–‡å­— (ç´”ç™½) */
        --text-dark: #ffffff; /* æ·±è‰²èƒŒæ™¯ä¸‹ä½¿ç”¨ç™½è‰²æ–‡å­— */
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      body {
        font-family: "Zen Maru Gothic", sans-serif;
        /* èƒŒæ™¯æ¼¸è®Š - æ·ºè—åˆ°ä¸­è— */
        background: linear-gradient(
          135deg,
          #4fa3d1 0%,
          /* æ·ºè— */ #2196f3 100% /* ä¸­è— */
        );
        min-height: 100vh;
        color: var(--text-dark);
        overflow-x: hidden;
      }

      /* === Loading Screen æ¨£å¼ (ç¢ºä¿åœ¨è¼‰å…¥å‰è¦†è“‹æ•´å€‹ç•«é¢) === */
      .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #0077b6 0%, #00b4d8 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 100;
        transition: opacity 0.5s;
        color: white;
      }
      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      /* é ‚éƒ¨ç‹€æ…‹åˆ— */
      .status-bar {
        padding: 15px 20px;
        color: var(--text-light);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }

      /* === ä¸»è¦å®¹å™¨ï¼Œç”¨æ–¼ç½®ä¸­å’Œæœ€å¤§å¯¬åº¦ === */
      .main-wrapper {
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding-top: 80px;
      }

      /* === Grid Layout (é›»è…¦ç‰ˆä¸»è¦çµæ§‹) === */
      .main-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 30px;
        width: 100%;
      }

      @media (min-width: 900px) {
        .main-grid {
          grid-template-columns: 1fr 2fr;
          align-items: start;
        }

        .left-col {
          grid-column: 1 / 2;
          padding-top: 50px;
        }

        .right-col {
          grid-column: 2 / 3;
          display: flex;
          flex-direction: column;
          gap: 20px;
        }
      }

      /* === å·¦æ¬„æ¨£å¼ (æ—¥æœŸã€åœ°é»ã€å€‰é¼ ) === */
      .date-info h1 {
        font-size: 6rem;
        font-weight: 900;
        color: var(--text-light);
        line-height: 1.2;
        text-shadow: 0 5px 8px rgba(0, 0, 0, 0.3);
        margin-bottom: 10px;
      }

      .date-info p {
        color: var(--text-light);
        font-size: 1.2rem;
        font-weight: bold;
        margin-bottom: 25px;
        line-height: 1.5;
      }

      .location-pill {
        display: inline-flex;
        align-items: center;
        background: rgba(255, 255, 255, 0.4);
        color: var(--text-dark);
        padding: 8px 15px;
        border-radius: 25px;
        font-weight: 900;
        font-size: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.8);
        margin-bottom: 30px;
      }

      .location-pill span {
        margin: 0 5px;
      }

      .hamster-area {
        display: flex;
        align-items: flex-end;
        gap: 15px;
        margin-top: 50px;
      }

      .hamster-image {
        width: 150px;
        height: 150px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 120px;
        flex-shrink: 0;
        filter: drop-shadow(0 8px 10px rgba(0, 0, 0, 0.2));
        animation: float 4s infinite ease-in-out;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-5px);
        }
      }

      .speech-bubble {
        background: white;
        color: #4e5661;
        border-radius: 20px;
        padding: 15px;
        position: relative;
        border: 1px solid rgba(0, 0, 0, 0.1);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        font-weight: bold;
        flex-grow: 1;
        font-size: 1rem;
        max-width: 250px;
      }

      .speech-bubble::before {
        content: "";
        position: absolute;
        bottom: 10px;
        left: -8px;
        width: 0;
        height: 0;
        border-right: 15px solid white;
        border-bottom: 8px solid transparent;
        border-top: 8px solid transparent;
        transform: rotate(30deg);
      }

      /* === å³æ¬„æ¨£å¼ === */

      /* æ•¸æ“šä¸‰é€£å¡ */
      .metric-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
      }

      .metric-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        padding: 25px 10px;
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        box-shadow: var(--glass-shadow);
        border-radius: 20px;
        color: var(--text-dark);
      }

      .metric-icon {
        font-size: 2.5rem;
        margin-bottom: 5px;
        color: var(--primary-dark);
      }

      .metric-value {
        font-size: 2.2rem;
        font-weight: 900;
        line-height: 1.1;
        color: var(--primary-dark);
      }

      .metric-label {
        font-size: 0.8rem;
        color: var(--text-dark);
        opacity: 0.8;
      }

      /* èˆ’é©åº¦æŒ‡æ¨™ */
      .comfort-card {
        padding: 20px;
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
        box-shadow: var(--glass-shadow);
      }

      .comfort-title {
        color: var(--text-dark);
        font-weight: 900;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        font-size: 1.1rem;
        text-shadow: none;
      }

      .comfort-bar-wrapper {
        position: relative;
        height: 10px;
        background: linear-gradient(
          to right,
          #64b5f6,
          #aed581,
          #ffeb3b,
          #ff9800,
          #f44336
        );
        border-radius: 5px;
        margin-bottom: 15px;
      }

      #comfortMarker {
        position: absolute;
        width: 18px;
        height: 18px;
        background: white;
        border: 3px solid var(--primary-dark);
        border-radius: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      /* é å ±å€å¡Š */
      .forecast-card {
        padding: 20px;
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
        box-shadow: var(--glass-shadow);
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        color: var(--text-dark);
      }

      .section-header h3 {
        font-size: 1.2rem;
        font-weight: 900;
        text-shadow: none;
      }

      .time-pill {
        background: rgba(0, 0, 0, 0.1);
        padding: 3px 10px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: bold;
        color: var(--text-dark);
      }

      /* ä¿®æ­£ï¼šæœªä¾†é å ±å¡ç‰‡ä½ˆå±€ */
      .scroll-container {
        display: grid;
        grid-template-columns: repeat(2, 1fr); /* å…©æ¬„ä½ˆå±€ */
        gap: 15px;
        overflow-x: hidden; /* ç§»é™¤æ»¾å‹• */
        padding-bottom: 0;
      }

      .mini-card {
        /* è®“å¡ç‰‡å¯¬åº¦å¡«æ»¿ grid æ¬„ä½ */
        width: 100%;
        min-width: unset;
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(8px);
        border-radius: 15px;
        padding: 18px 20px;
        text-align: left;
        border: 1px solid rgba(255, 255, 255, 0.5);
        flex-shrink: 0;
        color: var(--text-dark);
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        align-items: center;
      }

      .mini-left {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .mini-time {
        font-weight: 900;
        font-size: 0.95rem;
        color: var(--text-dark);
        opacity: 0.9;
        line-height: 1;
      }

      .mini-weather {
        font-size: 0.85rem;
        opacity: 0.85;
        line-height: 1.3;
      }

      .mini-icon {
        font-size: 2.8rem;
        margin: 5px 0;
        color: var(--primary-dark);
      }

      .mini-right {
        display: flex;
        flex-direction: row;
        gap: 8px;
        align-items: flex-end;
      }

      .mini-temp {
        font-size: 1.8rem;
        font-weight: 900;
        color: var(--primary-dark);
        line-height: 1;
      }

      .mini-rain-prob {
        color: var(--text-dark);
        opacity: 0.8;
        font-size: 0.75rem;
        display: flex;
        gap: 10px;
      }

      /* å€‰é¼ è­¦å‘Šå€å¡Š (Hamster Warning) */
      #hamsterWarning {
        margin-top: 20px;
      }

      .hamster-warning-card {
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
        padding: 20px;
        box-shadow: var(--glass-shadow);
      }

      .warning-title {
        color: var(--danger-color);
        font-size: 1.1rem;
        font-weight: 900;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
      }
      .warning-title span {
        margin-right: 10px;
      }

      .warning-list {
        list-style: none;
        padding-left: 0;
      }

      .warning-list li {
        font-size: 0.95rem;
        margin-bottom: 8px;
        color: var(--text-dark);
      }

      .warning-list li::before {
        content: "";
        display: none;
      }

      /* æ‰‹æ©Ÿç‰ˆé©æ‡‰æ€§èª¿æ•´ */
      @media (max-width: 899px) {
        .hamster-area {
          justify-content: center;
          flex-direction: column;
          align-items: center;
          text-align: center;
        }
        .hamster-image {
          width: 120px;
          height: 120px;
          font-size: 100px;
        }
        .speech-bubble {
          max-width: 100%;
          margin-top: 15px;
        }
        .speech-bubble::before {
          left: 50%;
          bottom: auto;
          top: -15px;
          transform: translateX(-50%) rotate(210deg);
        }
        .date-info h1 {
          font-size: 5rem;
        }
        /* æ‰‹æ©Ÿæ¿çš„æœªä¾†é å ±å¡ç‰‡ä¹Ÿæ˜¯ 50% ä½ˆå±€ */
        .scroll-container {
          grid-template-columns: 1fr 1fr;
        }
      }
    </style>
  </head>

  <body>
    <div id="loading" class="loading-screen">
      <div style="font-size: 4rem; animation: bounce 2s infinite">ğŸ¹</div>
      <p style="color: white; font-weight: bold; margin-top: 20px">
        æ­£åœ¨é€£æ¥æ°£è±¡å±€æ•¸æ“š...
      </p>
    </div>

    <div class="main-wrapper" id="mainContent" style="display: none">
      <div class="main-grid">
        <div class="left-col">
          <div class="date-info">
            <h1 id="currentDate">--</h1>
            <p
              id="currentMonth"
              style="
                font-size: 0.95rem;
                font-weight: 600;
                margin-bottom: 8px;
                opacity: 0.95;
              "
            >
              Loading...
            </p>
            <p
              id="currentTime"
              style="
                font-size: 1.8rem;
                font-weight: 900;
                margin-bottom: 15px;
                line-height: 1.2;
              "
            >
              --:--
            </p>
            <p id="currentDay">Loading...</p>
          </div>

          <div class="location-pill">
            <span>å°ä¸­å¸‚</span>
            <span style="font-size: 1.2rem; cursor: pointer">&#x21BB;</span>
          </div>

          <div class="hamster-area">
            <div class="hamster-image">ğŸ¹</div>
            <div class="speech-bubble" id="hamsterMascot">...</div>
          </div>
        </div>

        <div class="right-col">
          <div class="metric-grid">
            <div class="metric-card">
              <div class="metric-icon">ğŸŒ¡ï¸</div>
              <div class="metric-value" id="currentTemp">--Â°</div>
              <div class="metric-label">ç›®å‰æ°£æº«</div>
            </div>
            <div class="metric-card">
              <div class="metric-icon">ğŸ’§</div>
              <div class="metric-value" id="currentHumidity">--%</div>
              <div class="metric-label">ç›¸å°æ¿•åº¦</div>
            </div>
            <div class="metric-card">
              <div class="metric-icon">â˜”</div>
              <div class="metric-value" id="currentRain">--%</div>
              <div class="metric-label">é™é›¨æ©Ÿç‡</div>
            </div>
          </div>

          <div class="comfort-card">
            <div class="comfort-title">
              <span>èˆ’é©åº¦æŒ‡æ¨™</span>
              <span style="font-size: 0.9rem">å†· â€¢ æ¶¼ â€¢ é© â€¢ æº« â€¢ ç†±</span>
            </div>
            <div class="comfort-bar-wrapper">
              <div id="comfortMarker" style="left: 50%"></div>
            </div>
          </div>

          <div class="forecast-card">
            <div class="section-header">
              <h3>æœªä¾†å¤©æ°£é å ±</h3>
              <div class="time-pill">12H</div>
            </div>
            <div class="scroll-container" id="futureForecasts"></div>
          </div>

          <div id="hamsterWarning">
            <div class="hamster-warning-card">
              <div class="warning-title"><span>ğŸ’¡</span> è¼‰å…¥ä¸­...</div>
              <ul class="warning-list">
                <li>è«‹ç­‰å¾…æ•¸æ“šé€£æ¥</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const API_URL = "https://weather-ham.zeabur.app/api/weather/kaohsiung";

      // å€‰é¼ å»ºè­°çš„æº«åº¦å’Œæ¿•åº¦è‡¨ç•Œå€¼
      const HAMSTER_CRITICAL_HOT = 26;
      const HAMSTER_CRITICAL_COLD = 18;
      const HAMSTER_CRITICAL_HUMID = 70;
      const HAMSTER_CRITICAL_DRY = 35;

      function getWeatherIcon(weather) {
        if (!weather) return "ğŸŒ¤ï¸";
        if (weather.includes("æ™´")) return "â˜€ï¸";
        if (weather.includes("å¤šé›²")) return "â›…";
        if (weather.includes("é™°")) return "â˜ï¸";
        if (weather.includes("é›¨")) return "ğŸŒ§ï¸";
        if (weather.includes("é›·")) return "â›ˆï¸";
        return "ğŸŒ¤ï¸";
      }

      function getHamsterMascotText(currentTemp, humidity) {
        if (currentTemp > HAMSTER_CRITICAL_HOT) {
          return `ğŸ”¥ ä¸»äººï¼ç¾åœ¨ ${currentTemp}Â°Cï¼Œå¥½ç†±å–”ï¼æˆ‘å¿«è¦ç†±æšˆäº†ï¼è«‹å¹«æˆ‘é–‹å†·æ°£ï¼`;
        }
        if (currentTemp < HAMSTER_CRITICAL_COLD) {
          return `ğŸ¥¶ ä¸»äººï¼Œç¾åœ¨åªæœ‰ ${currentTemp}Â°C... æˆ‘æ„Ÿè¦ºè¦é€²å…¥å‡å†¬çœ äº†ï¼Œå¿«å¹«æˆ‘åŠ æš–æ°£ï¼`;
        }
        if (humidity > HAMSTER_CRITICAL_HUMID) {
          return `ğŸ’§ ä¸»äººï¼Œæ¿•åº¦ ${humidity}%ï¼æˆ‘çš„å¢Šæè¦ç™¼éœ‰äº†... è¶•å¿«å•Ÿå‹•é™¤æ¿•æ©Ÿï¼`;
        }
        if (currentTemp >= 20 && currentTemp <= 25) {
          return `ğŸ’– ä¸»äººï¼Œ${currentTemp}Â°C å¥½èˆ’æœï¼Œè®“æˆ‘å†åƒå¹¾é¡†é»å¿ƒå§ï¼æ‰­æ‰­ï½`;
        }
        return `ğŸŒ¤ï¸ ä¸»äººï¼Œå¤©æ°£ä¸éŒ¯å–”ï¼åˆ¥å¿˜äº†å¹«æˆ‘æ›æ–°é®®çš„é£²ç”¨æ°´ã€‚`;
      }

      function getHamsterWarning(maxTemp, minTemp, humidity) {
        let title = "âœ¨ å€‰é¼ ç’°å¢ƒèˆ’é©ï¼Œç¹¼çºŒä¿æŒï¼";
        let isDanger = false;
        let adviceList = [];

        if (maxTemp > HAMSTER_CRITICAL_HOT) {
          title = "æ¥µåº¦å±éšªï¼ æº«åº¦éé«˜å®¹æ˜“å°è‡´ä¸­æš‘ã€‚";
          isDanger = true;
          adviceList.push("ğŸš¨ ç«‹åˆ»é™æº«ï¼ é–‹å•Ÿå†·æ°£æˆ–é¢¨æ‰‡ï¼Œä¸¦æ”¾ç½®é™æº«çŸ³ã€‚");
          adviceList.push("ğŸ’¦ ç¢ºèªæ°´ç“¶æ°´é‡ï¼Œä¸¦æä¾›æ–°é®®é£²ç”¨æ°´ã€‚");
        } else if (minTemp < HAMSTER_CRITICAL_COLD) {
          title = "æ¥µåº¦å±éšªï¼ æº«åº¦éä½å€‰é¼ å¯èƒ½å‡æ€§å†¬çœ ã€‚";
          isDanger = true;
          adviceList.push("ğŸ”¥ ç«‹åˆ»ä¿æš–ï¼ æª¢æŸ¥ä¿æš–å¢Šæ˜¯å¦é–‹å•Ÿã€å¢Šææ˜¯å¦è¶³å¤ ã€‚");
          adviceList.push("ğŸŒ¡ï¸ å»ºè­°å°‡ç± å­ç§»è‡³ç„¡é¢¨å£ã€æº«åº¦æ›´ç©©å®šçš„å®¤å…§æ·±è™•ã€‚");
        }

        if (humidity > HAMSTER_CRITICAL_HUMID) {
          title = "WARNING æ¿•æ°£å¤ªé‡äº†ï¼";
          isDanger = true;
          adviceList.push("æ¿•åº¦éé«˜å®¹æ˜“å°è‡´çš®è†šç—…æˆ–å¢Šæç™¼éœ‰ã€‚");
          adviceList.push("é–‹å•“é™¤æ¿•æ©Ÿ (æ§åˆ¶åœ¨ 50-60%)");
          adviceList.push("æ›´æ›æˆ–å¢åŠ ä¹¾ç‡¥å¢Šæ");
          adviceList.push("æª¢æŸ¥é£¼æ–™æœ‰ç„¡å—æ½®");
        } else if (humidity < HAMSTER_CRITICAL_DRY) {
          if (!isDanger) {
            title = "ä¹¾ç‡¥è­¦å ±ï¼ æ¿•åº¦éä½ï¼Œå°å¿ƒå€‰é¼ è„«æ°´æˆ–çš®è†šä¹¾ç‡¥ã€‚";
          }
          adviceList.push(
            "ğŸŒ¬ï¸ å¯åœ¨ç± é‚Šæ”¾ç½®ä¸€æ¯æ°´æˆ–æ¿•æ¯›å·¾ï¼Œä½†éœ€ç¢ºä¿æ°´ä¸æœƒè¢«å€‰é¼ æ‰“ç¿»ã€‚"
          );
        }

        if (adviceList.length === 0 || title.includes("èˆ’é©")) {
          title = "âœ¨ å€‰é¼ ç’°å¢ƒèˆ’é©ï¼Œç¹¼çºŒä¿æŒï¼";
          isDanger = false;
          adviceList = ["ğŸ‘ ä»Šå¤©æ˜¯å€‹å¥½æ—¥å­ï¼è«‹ç¢ºèªé£¼æ–™å’Œæ°´æ˜¯æ–°é®®çš„ã€‚"];
        }

        return { title, adviceList, isDanger };
      }

      function getComfortMarkerPosition(temp) {
        const minRange = 10;
        const maxRange = 35;
        let position = ((temp - minRange) / (maxRange - minRange)) * 100;
        position = Math.max(0, Math.min(100, position));
        return position;
      }

      function renderWeather(forecasts) {
        if (!forecasts || forecasts.length === 0) {
          document.getElementById("hamsterMascot").innerHTML =
            "ğŸ˜¥ è³‡æ–™éŒ¯èª¤ï¼Œè«‹é‡æ–°æ•´ç†ã€‚";
          return;
        }

        // API çš„ç¬¬ä¸€å€‹é …ç›®æ˜¯ç•¶å‰çš„å¤©æ°£ç‹€æ³
        const current = forecasts[0];
        const others = forecasts.slice(1);

        // è§£ææº«åº¦ï¼ˆAPI è¿”å› "20Â°C" æ ¼å¼ï¼‰
        const minTempStr = current.minTemp
          ? current.minTemp.replace("Â°C", "")
          : "20";
        const maxTempStr = current.maxTemp
          ? current.maxTemp.replace("Â°C", "")
          : "25";
        const minTemp = parseInt(minTempStr);
        const maxTemp = parseInt(maxTempStr);
        const avgTemp = Math.round((maxTemp + minTemp) / 2);

        // è§£ææ¿•åº¦å’Œé™é›¨æ©Ÿç‡ï¼ˆAPI è¿”å› "20%" æ ¼å¼ï¼‰
        const rainStr = current.rain ? current.rain.replace("%", "") : "10";
        const rainProb = parseInt(rainStr);
        // å¦‚æœæ²’æœ‰æ¿•åº¦ä¿¡æ¯ï¼Œæ ¹æ“šèˆ’é©åº¦ç­‰ç´šä¼°ç®—
        const humidity = current.comfort
          ? estimateHumidity(current.comfort)
          : 65;

        // 1. æ¸²æŸ“æ—¥æœŸå’Œæ™‚é–“
        const now = new Date();
        const daysOfWeek = [
          "Sunday",
          "Monday",
          "Tuesday",
          "Wednesday",
          "Thursday",
          "Friday",
          "Saturday",
        ];
        const months = [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December",
        ];

        document.getElementById("currentDate").textContent = now.getDate();
        document.getElementById("currentMonth").textContent =
          months[now.getMonth()];
        document.getElementById("currentDay").textContent = `${
          daysOfWeek[now.getDay()]
        }, ${months[now.getMonth()]}`;
        document.getElementById(
          "currentTime"
        ).textContent = `${now.getHours()}:${now
          .getMinutes()
          .toString()
          .padStart(2, "0")}`;

        // 2. æ¸²æŸ“æ ¸å¿ƒæ•¸æ“šå¡ç‰‡ (Metric Grid)
        document.getElementById("currentTemp").textContent = `${avgTemp}Â°`;
        document.getElementById("currentHumidity").textContent = `${humidity}%`;
        document.getElementById("currentRain").textContent = `${rainProb}%`;

        // 3. æ¸²æŸ“å€‰é¼ å‰ç¥¥ç‰©å°è©±
        const mascotText = getHamsterMascotText(avgTemp, humidity);
        document.getElementById("hamsterMascot").innerHTML = mascotText;

        // 4. æ¸²æŸ“èˆ’é©åº¦æŒ‡æ¨™
        const markerPosition = getComfortMarkerPosition(avgTemp);
        document.getElementById(
          "comfortMarker"
        ).style.left = `${markerPosition}%`;

        // 5. æ¸²æŸ“å€‰é¼ è­¦å‘Šå€å¡Š
        const warningData = getHamsterWarning(maxTemp, minTemp, humidity);
        const listItems = warningData.adviceList
          .map((advice) => `<li>${advice}</li>`)
          .join("");

        const isHighHumidityWarning = warningData.title.includes("WARNING");
        const warningColor = isHighHumidityWarning
          ? "var(--danger-color)"
          : warningData.isDanger
          ? "var(--danger-color)"
          : "var(--primary-dark)";
        const warningIcon = isHighHumidityWarning
          ? "âš ï¸"
          : warningData.isDanger
          ? "ğŸš¨"
          : "ğŸ’¡";
        const titleText = isHighHumidityWarning
          ? warningData.title.replace("WARNING ", "")
          : warningData.title;

        // æ¸²æŸ“è­¦å‘Šå¡ç‰‡
        document.getElementById("hamsterWarning").innerHTML = `
            <div class="hamster-warning-card">
                <div class="warning-title" style="color: ${warningColor};">
                    <span>${warningIcon}</span> ${titleText}
                </div>
                ${
                  isHighHumidityWarning
                    ? // æ ¹æ“šè¨­è¨ˆåœ–ï¼Œå°‡ç¬¬ä¸€è¡Œè­¦å‘Šä½œç‚ºæ®µè½æ”¾åœ¨æ¨™é¡Œä¸‹æ–¹
                      `<p style="font-size: 0.95rem; color: var(--text-dark); font-weight: 500; margin-top: -5px; margin-bottom: 10px;">
                        ${warningData.adviceList[0]}
                    </p>`
                    : ""
                }
                <ul class="warning-list">
                    ${
                      isHighHumidityWarning
                        ? // å¦‚æœæ˜¯é«˜æ¿•åº¦è­¦å‘Šï¼Œåˆ—è¡¨å¾ç¬¬äºŒè¡Œé–‹å§‹
                          warningData.adviceList
                            .slice(1)
                            .map((advice) => `<li>${advice}</li>`)
                            .join("")
                        : listItems
                    }
                </ul>
            </div>
        `;

        // 6. æ¸²æŸ“æœªä¾†é å ± (Mini Cards) - åªå–å‰å…©å¼µ
        const scrollContainer = document.getElementById("futureForecasts");
        scrollContainer.innerHTML = "";
        const todayDate = new Date().getDate();
        const nextDayDate = new Date(now);
        nextDayDate.setDate(nextDayDate.getDate() + 1);

        // å¦‚æœ API æ•¸æ“šä¸è¶³ï¼Œå‰‡é¡¯ç¤ºä½”ä½ç¬¦
        if (others.length < 2) {
          scrollContainer.innerHTML = `<p style="text-align: center; color: var(--text-dark); opacity: 0.7; grid-column: 1 / 3;">æœªä¾†æ™‚æ®µæ•¸æ“šä¸è¶³ã€‚</p>`;
          return;
        }

        others.slice(0, 2).forEach((f, index) => {
          // *** åªå–å‰å…©å€‹æ™‚æ®µ ***
          const fDate = new Date(f.startTime);
          const fHour = fDate.getHours();

          // è§£ææº«åº¦
          const fMaxTempStr = f.maxTemp ? f.maxTemp.replace("Â°C", "") : "25";
          const fMinTempStr = f.minTemp ? f.minTemp.replace("Â°C", "") : "20";
          const fMaxTemp = parseInt(fMaxTempStr);
          const fMinTemp = parseInt(fMinTempStr);

          // è§£æé™é›¨æ©Ÿç‡
          const fRainStr = f.rain ? f.rain.replace("%", "") : "0";
          const fRainProb = parseInt(fRainStr);

          let timeLabel = `${fHour}:00`;

          // åˆ¤æ–·æ˜¯å¦ç‚ºã€Œæ˜å¤©ã€æˆ–ã€Œä»Šå¤©ã€
          if (fDate.getDate() === nextDayDate.getDate()) {
            timeLabel = "æ˜å¤©";
          } else if (fDate.getDate() > todayDate) {
            // å¦‚æœæ˜¯ä»Šå¤©ä»¥å¾Œï¼Œé¡¯ç¤ºæ™‚é–“
          } else {
            timeLabel = `${fHour}:00`; // è™•ç†ä»Šæ—¥ç¨æ™šçš„é å ±
          }

          // æå–æ™‚é–“ç¯„åœ
          const startTimeStr = f.startTime
            ? f.startTime.substring(11, 16)
            : "--:--"; // HH:mm
          const endTimeStr = f.endTime ? f.endTime.substring(11, 16) : "--:--"; // HH:mm
          const timeRange = `${startTimeStr} ~ ${endTimeStr}`;

          scrollContainer.innerHTML += `
                            <div class="mini-card">
                                <div class="mini-left">
                                    <div class="mini-time">${timeLabel}</div>
                                    <div class="mini-weather">${f.weather}</div>
                                    <div style="font-size: 0.7rem; opacity: 0.7;">${timeRange}</div>
                                </div>
                                <div class="mini-icon">${getWeatherIcon(
                                  f.weather
                                )}</div>
                                <div class="mini-right">
                                    <div class="mini-temp">${fMaxTemp}Â°</div>
                                    <div class="mini-rain-prob"><span>ğŸŒ§ï¸${fRainProb}%</span><span>ğŸ’¨${Math.round(
            (fRainProb + 20) % 100
          )}%</span></div>
                                </div>
                            </div>
                        `;
        });
      }

      // æ ¹æ“šèˆ’é©åº¦ç­‰ç´šä¼°ç®—æ¿•åº¦
      function estimateHumidity(comfort) {
        if (comfort.includes("å¯’æ„") || comfort.includes("å†·")) return 45;
        if (comfort.includes("èˆ’é©")) return 60;
        if (comfort.includes("æ‚¶ç†±") || comfort.includes("ç†±")) return 75;
        return 60;
      }

      async function fetchWeather() {
        const loadingElement = document.getElementById("loading");
        const mainContentElement = document.getElementById("mainContent");
        const fetchStart = Date.now();
        const MIN_DELAY = 1500; // æœ€å°å»¶é² 1.5 ç§’ï¼Œç”¨æ–¼ UX

        try {
          // 1. Fetch data
          const response = await fetch(API_URL);

          // 2. æª¢æŸ¥ HTTP ç‹€æ…‹ç¢¼
          if (!response.ok) {
            throw new Error(`HTTP éŒ¯èª¤ï¼ç‹€æ…‹ç¢¼ï¼š${response.status}`);
          }

          // 3. è§£æ JSON
          const json = await response.json();

          // 4. è©³ç´°çš„èª¿è©¦æ—¥èªŒ
          console.log("=== API è¿”å›ä¿¡æ¯ ===");
          console.log("HTTP ç‹€æ…‹ç¢¼:", response.status);
          console.log("å®Œæ•´éŸ¿æ‡‰:", JSON.stringify(json, null, 2));
          console.log("é ‚ç´šé‘°åŒ™:", Object.keys(json));

          // 5. å˜—è©¦å¤šç¨®æ–¹å¼è§£ææ•¸æ“š
          let weatherData = null;

          // æ–¹æ³• 1: json.success && json.data.forecasts
          if (
            json.success &&
            json.data &&
            json.data.forecasts &&
            Array.isArray(json.data.forecasts)
          ) {
            console.log("âœ“ ä½¿ç”¨æ–¹æ³• 1: json.success && json.data.forecasts");
            weatherData = json.data.forecasts;
          }
          // æ–¹æ³• 2: json.success && json.data (å¦‚æœ data æœ¬èº«æ˜¯é™£åˆ—)
          else if (json.success && json.data && Array.isArray(json.data)) {
            console.log("âœ“ ä½¿ç”¨æ–¹æ³• 2: json.success && json.data (é™£åˆ—)");
            weatherData = json.data;
          }
          // æ–¹æ³• 3: ç›´æ¥æ˜¯é™£åˆ—
          else if (Array.isArray(json)) {
            console.log("âœ“ ä½¿ç”¨æ–¹æ³• 3: ç›´æ¥æ˜¯é™£åˆ—");
            weatherData = json;
          }
          // æ–¹æ³• 4: åªæœ‰ data.forecasts æ¬„ä½
          else if (
            json.data &&
            json.data.forecasts &&
            Array.isArray(json.data.forecasts)
          ) {
            console.log("âœ“ ä½¿ç”¨æ–¹æ³• 4: json.data.forecasts");
            weatherData = json.data.forecasts;
          }
          // æ–¹æ³• 5: åªæœ‰ data æ¬„ä½
          else if (json.data && Array.isArray(json.data)) {
            console.log("âœ“ ä½¿ç”¨æ–¹æ³• 5: json.data");
            weatherData = json.data;
          }
          // æ–¹æ³• 6: æª¢æŸ¥æ˜¯å¦æœ‰åµŒå¥—çš„ records
          else if (json.result && Array.isArray(json.result)) {
            console.log("âœ“ ä½¿ç”¨æ–¹æ³• 6: json.result");
            weatherData = json.result;
          }
          // æ–¹æ³• 7: æª¢æŸ¥æ˜¯å¦æ˜¯ä¸­å¤®æ°£è±¡ç½²çš„æ ¼å¼
          else if (json.records && Array.isArray(json.records)) {
            console.log("âœ“ ä½¿ç”¨æ–¹æ³• 7: json.records");
            weatherData = json.records;
          }

          // å¦‚æœæ‰¾åˆ°æ•¸æ“š
          if (weatherData && weatherData.length > 0) {
            console.log("âœ“ æˆåŠŸå–å¾—å¤©æ°£æ•¸æ“šï¼Œé …ç›®æ•¸:", weatherData.length);
            console.log("ç¬¬ä¸€é …æ•¸æ“š:", JSON.stringify(weatherData[0], null, 2));
            renderWeather(weatherData);
          } else {
            console.error("âŒ ç„¡æ³•å¾ API éŸ¿æ‡‰ä¸­æå–æ•¸æ“š");
            console.error("éŸ¿æ‡‰å…§å®¹:", json);
            throw new Error(
              `ç„¡æ³•è§£æ API æ•¸æ“šã€‚éŸ¿æ‡‰çµæ§‹: ${Object.keys(json).join(", ")}`
            );
          }
        } catch (e) {
          // æ•ç²æ‰€æœ‰éŒ¯èª¤
          console.error("âŒ éŒ¯èª¤è©³æƒ…:", e);
          console.error("éŒ¯èª¤å †æ£§:", e.stack);

          let errorMessage = e.message || "ç„¡æ³•é€£æ¥æˆ–ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ã€‚";

          // æ ¹æ“šéŒ¯èª¤é¡å‹çµ¦å‡ºæç¤º
          if (
            errorMessage.includes("Failed to fetch") ||
            errorMessage.includes("NetworkError")
          ) {
            errorMessage = "ç„¡æ³•é€£æ¥åˆ°ä¼ºæœå™¨ã€‚è«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ– CORS è¨­å®šã€‚";
          } else if (errorMessage.includes("JSON")) {
            errorMessage = "ä¼ºæœå™¨å›å‚³äº†ç„¡æ•ˆçš„ JSON æ ¼å¼ã€‚";
          }

          alert(`å¤©æ°£è³‡æ–™è®€å–å¤±æ•—ï¼š${errorMessage}`);

          // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯åœ¨å¡ç‰‡ä¸Š
          document.getElementById(
            "hamsterMascot"
          ).innerHTML = `ç¶²è·¯é€£æ¥éŒ¯èª¤ ğŸ˜¥`;
        } finally {
          // è¨ˆç®—å·²ç¶“èŠ±è²»çš„æ™‚é–“
          const elapsedTime = Date.now() - fetchStart;
          const delay = Math.max(0, MIN_DELAY - elapsedTime);

          setTimeout(() => {
            loadingElement.style.display = "none";
            mainContentElement.style.display = "block";
          }, delay);
        }
      }

      document.addEventListener("DOMContentLoaded", fetchWeather);
    </script>
  </body>
</html>
